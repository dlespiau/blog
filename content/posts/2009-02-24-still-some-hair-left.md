+++
title = "Still some hair left"
date = 2009-02-24T11:11:00Z
updated = 2016-02-07T14:06:06Z
tags = ["cool hacks"]
blogimport = true 
[author]
	name = "Damien Lespiau"
	uri = "https://plus.google.com/114288295280403017038"
+++

I've been asked to give more input on <code class="command">make V=1</code> Vs. <code class="command">--disable-shave</code>, so here it is: once again, before shipping your package with shave enabled by default, there is something crucial to understand: <code class="command">make V=1</code> (when having configured your package with <code class="command">--enable-shave</code>) is <strong>NOT</strong> equivalent to no shave at all (ie <code class="command">--disable-shave</code>). This is because the shave m4 macro is setting <code>MAKEFLAGS=-s</code> in every single Makefile. This means that make won't print the commands as is used to, and that the only way to print something on the screen is to echo it. It's precisely what the shave wrappers do, they echo the CC/CXX and LIBTOOL commands when <code>V=1</code>. So in short custom rules and a few automake commands won't be displayed with <code class="command">make V=1</code>.<br /><br />That said, it's possible to craft a rule that would display the command with shaved enabled and <code class="command">make V=1</code>. The following rule:<br /><pre class="brush: text; gutter: true">lib-file2.h: Makefile<br />$(SHAVE_GEN)echo &quot;#define FOO_DEFINE 0xbabe&quot; &gt; lib-file2.h</pre>would become:<br /><pre class="brush: text; gutter: true">lib-file2.h: Makefile<br />@cmd=&#039;echo &quot;#define FOO_DEFINE 0xbabe&quot; &gt; lib-file2.h&#039;; \<br />if test x&quot;$$V&quot; = x1; then echo $$cmd; fi<br />$(SHAVE_GEN)echo &quot;#define FOO_DEFINE 0xbabe&quot; &gt; lib-file2.h</pre>which is quite ugly, to say the least. (if you find a smarter way, please enlighten me!).<br /><br />On the development side, shave is slowly becoming more mature:<br /><ul><li>Thanks to Jan Schmidt, shave works with non GNU <code class="command">sed</code> and <code class="command">echo</code> that do not support <code>-n</code>. It now works on Solaris, hopefully on BSDs and various Unixes as well (not tested though).</li> <li><code>SHAVE_INIT</code> has a new, optional, parameter which empowers the programmer to define shave's default behaviour (when <code class="command">./configure</code> is run without shave any related option): either <code>enable</code> or <code>disable</code>. ie. <code>SHAVE_INIT([autootols], [enable])</code> will instruct shave to find its wrapper scripts in the autotools directory and that running <code class="command">./configure</code> will actually enable the beast. SHAVE_INIT without parameters at all is supposed to mean that the wrapper scripts are in <code>$top_builddir</code> and that <code class="command">./configure</code> will not enable shave without the <code class="command">--enable-shave</code> option.</li> <li>however, shave has been reported to fail miserably with scratchbox.</li> </ul>
