+++
title = "Clutter on Android: first results"
date = 2011-01-31T15:41:00Z
updated = 2016-02-07T13:38:18Z
tags = ["Clutter", "Android"]
blogimport = true 
[author]
	name = "Damien Lespiau"
	uri = "https://plus.google.com/114288295280403017038"
+++

<div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on">With the release of Android 2.3, there's a <em>decent</em> way to  integrate native applications with the NativeActivity class, an EGL  library, and some C API to expose events, main loop, etc. So? how about porting Clutter to it now that it looks actually feasible? After a few days of work, the first results are there, quite promising!</div><br /><div class="separator" style="clear: both; text-align: center;"><iframe width="320" height="266" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/bxxNHZTPxW4/0.jpg" src="https://www.youtube.com/embed/bxxNHZTPxW4?feature=player_embedded" frameborder="0" allowfullscreen></iframe></div><br />There's still a fairly large number of items in my TODO before being happy with the state of this work, the most prominent items are:<br /><ul><li>Get a clean up pass done to have something upstreamable, this includes finishing the event integration (it receives events but not yet forward them to Clutter),</li><li>Come up with a plan to manage the application life cycle and handle the case when Android destroys the EGL surface that you were using (probably by having the app save a state, and properly tear down Clutter).,</li><li>While you probably have the droid font installed in /system/fonts, this is not part of the advertised NDK interface. The safest choice is to  embed the font you want to use with your application. Unfortunately  fontconfig + freetype + pango + compressed assets in your Android package don't work really well together. Maybe solve it at the Pango level with a custom "direct" fontmap implementation that would let you register fonts from files easily?</li><li>What to do with text entries? show soft keyboard? Mx or Clutter problem? what happens to the GL surface in that case?</li><li>Better test the GMainLoop/ALooper main loop integration (esp. adding and removing file descriptors),</li><li>All the libraries that Clutter depends on are linked into a big .so (which is the Android NDK application). It results in a big .so (~5 MB, ~1.7 MB compressed in the .apk). That size can be dramatically reduced, sometimes at the expense of changes that will break the current API/ABI, but hell, you'll be statically linking anyway,</li><li>Provide "prebuilt libraries", ie. pre-compiled libraries that makes it easy to just use Clutter to build applications.</li></ul><br /></div>
