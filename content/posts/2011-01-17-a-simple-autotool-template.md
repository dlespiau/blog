+++
title = "A simple autotool template"
date = 2011-01-17T01:25:00Z
updated = 2016-02-06T23:59:53Z
tags = ["misc"]
blogimport = true 
[author]
	name = "Damien Lespiau"
	uri = "https://plus.google.com/114288295280403017038"
+++

<div dir="ltr" style="text-align: left;" trbidi="on">Every now and then, you feel a big urge to start hacking on a small thingy and need to create Makefiles for it. Turns out that the autotools won't be that intrusive when we are talking about small programs and you get do a reasonable job with a few lines, first the <code class="filename">configure.ac</code> file:<pre class="brush: text; gutter: true"># autoconf<br />AC_PREREQ(2.59)<br />AC_INIT([fart], [0.0.1], [damien.lespiau@gmail.com])<br />AC_CONFIG_MACRO_DIR([build])<br />AC_CONFIG_AUX_DIR([build])<br />AC_CONFIG_SRCDIR([fart.c])<br />AC_CONFIG_HEADERS([config.h])<br /><br /># automake<br />AM_INIT_AUTOMAKE([1.11 -Wall foreign no-define])<br />AM_SILENT_RULES([yes])<br /><br /># Check for programs<br />AC_PROG_CC<br /><br /># Check for header files<br />AC_HEADER_STDC<br /><br />AS_COMPILER_FLAGS([WARNING_CFLAGS],<br />["-Wall -Wshadow -Wcast-align -Wno-uninitialized<br />-Wno-strict-aliasing -Wempty-body -Wformat -Wformat-security<br />-Winit-self -Wdeclaration-after-statement -Wvla<br />-Wpointer-arith"])<br /><br />PKG_CHECK_MODULES([GLIB], [glib-2.0 &gt;= 2.24])<br /><br />AC_OUTPUT([<br />Makefile<br />])</pre>and then <code class="filename">Makefile.am</code>:<pre class="brush: text; gutter: true">ACLOCAL_AMFLAGS = -I build ${ACLOCAL_FLAGS}<br /><br />bin_PROGRAMS = fart<br /><br />fart_SOURCES = fart.c<br />fart_CFLAGS  = $(WARNING_CFLAGS) $(GLIB_CFLAGS)<br />fart_LDADD   = $(GLIB_LIBS)</pre>After that, it's just a matter of running <code class="command">autoreconf</code><pre class="brush: text; gutter: true">$ autoreconf -i</pre>and you are all set!<br />So, what do you get for this amount of lines?<ul><li>The usual set of automake targets, handy! ("make tags" is so under used!) and bonus features (out of tree builds, extra rules to reconfigure/rebuild the Makefiles on changes in configure.ac/Makefile.an, ...)</li><li>Trying to make the autoconf/automake discreet (putting auxiliary files out of the way, silence mode, automake for non GNU projects)</li><li>Some decent warning flags (tweak to your liking!)</li><li>autoreconf cooperating with aclocal thanks to ACLOCAL_AMFLAGS and coping with non standard locations for system m4 macros</li></ul>I'll maintain a <a href="http://git.lespiau.name/cgit/program-template-simple/" title="A simple autotool template">git tree</a> to help bootstrap my next small hacks, feel free to use it as well!</div>
